---
title: TCP 和 UDP 的主要区别是什么？
published: 2025-06-01
description: TCP 和 UDP 的主要区别是什么？
tags: [Markdown, Blogging]
category: Java mianshi
licenseName: "Unlicensed"
author: Ankou
sourceLink: ''
draft: false
---
**TCP 和 UDP 的主要区别是什么？TCP 如何保证可靠传输（三次握手、四次挥手、序列号/确认号、滑动窗口、超时重传、流量控制、拥塞控制）？为什么是三次握手四次挥手？**

**一、TCP 与 UDP 的核心区别**

|   **特性**   |      **TCP (传输控制协议)**      |  **UDP (用户数据报协议)**  |
| :----------: | :------------------------------: | :------------------------: |
|  **连接性**  |     面向连接（需先建立连接）     |   无连接（直接发送数据）   |
|  **可靠性**  | **可靠传输**（确认、重传、排序） |  不可靠（可能丢包、乱序）  |
| **传输效率** |      较低（需维护连接状态）      |   **极高**（无连接开销）   |
| **数据边界** |        字节流（可能粘包）        |   数据报（保留消息边界）   |
| **拥塞控制** |      有（动态调整发送速率）      |             无             |
| **头部开销** |         大（20-60 字节）         |      小（仅 8 字节）       |
| **适用场景** |     文件传输、网页浏览、邮件     | 视频流、语音通话、DNS 查询 |

**二、TCP 如何保证可靠传输？**

**1. 连接管理：三次握手与四次挥手**

- **三次握手（建立连接）**：

  ![](/q_img/​​三次握手（建立连接）.png)

  - **为什么不是两次？**
    防止失效的连接请求突然到达服务器（如网络延迟导致旧 `SYN` 重发），此时服务器误认为新连接，造成资源浪费。

- **四次挥手（断开连接）**:

  ![](/q_img/​​四次挥手.png)

  - 为什么是四次？

    TCP 是全双工通信，需双方独立关闭通道：

    1. 客户端发 `FIN` 表示不再发送（但仍可接收）；
    2. 服务器确认；
    3. 服务器发 `FIN` 表示不再发送；
    4. 客户端确认。



**2. 数据传输可靠性机制**

|      **机制**      |                           **原理**                           |             **作用**              |
| :----------------: | :----------------------------------------------------------: | :-------------------------------: |
| **序列号与确认号** | 每个数据包分配唯一 Seq 号；接收方回复 Ack 号（= 收到的 Seq + 数据长度） |    标识数据顺序，确认接收情况     |
|    **滑动窗口**    |    发送方维护发送窗口，接收方维护接收窗口（动态调整大小）    | **批量发送 + 流量控制**，提高效率 |
|    **超时重传**    |           发送后启动计时器，超时未收到 Ack 则重发            |             应对丢包              |
|    **快速重传**    |       收到 3 个重复 Ack 立即重发对应包（无需等待超时）       |           加速丢包恢复            |
|    **流量控制**    |      接收方通过 TCP 头部的 `窗口大小` 字段限制发送速率       |       防止接收方缓冲区溢出        |
|    **拥塞控制**    |         动态调整发送窗口（慢启动、拥塞避免、快恢复）         |           避免网络过载            |

**三、TCP 核心机制的深度解析**

**1. 滑动窗口（Sliding Window）**

- 发送窗口：包含 4 个区域：

  ```plaintext
  | 已发送且确认 | 已发送未确认 | 可发送但未发送 | 不可发送 |
  ```

- 工作流程：

  - 发送方每收到一个 Ack，窗口向右滑动，允许发送新数据。
  - 接收方通过 `窗口大小` 字段控制发送方速率（如缓冲区不足时设 `窗口大小=0`）。

**2. 拥塞控制（Congestion Control）**

- **慢启动（Slow Start）**：
  窗口从 1 MSS（最大报文段）开始，每 RTT（往返时延）翻倍，指数增长。
- **拥塞避免（Congestion Avoidance）**：
  窗口达到阈值（`ssthresh`）后，每 RTT 仅增加 1 MSS，线性增长。
- 拥塞发生时的处理：
  - **超时丢包**：`ssthresh = 当前窗口/2`，窗口重置为 1 MSS（重新慢启动）。
  - **重复 Ack（快速恢复）**：`ssthresh = 当前窗口/2`，窗口 = `ssthresh + 3 MSS`（跳过慢启动）。

**3. 流量控制（Flow Control） vs 拥塞控制（Congestion Control）**

|   **维度**   |       **流量控制**       |        **拥塞控制**        |
| :----------: | :----------------------: | :------------------------: |
| **控制目标** |   避免接收方缓冲区溢出   |      避免网络链路过载      |
| **决策依据** |    接收方的缓冲区大小    | 网络拥塞状态（丢包、延迟） |
| **实现机制** | TCP 头部 `窗口大小` 字段 | AIMD（加性增/乘性减）算法  |

**四、为什么 UDP 更快？**

1. **无连接建立/断开开销**：无需握手/挥手。
2. **无重传机制**：丢包不重传，适合实时媒体（如视频丢帧优于卡顿）。
3. **无拥塞控制**：可全力发送数据（但也可能加剧网络拥塞）。
4. **头部开销小**：8 字节 vs TCP 至少 20 字节。

**五、总结：TCP 与 UDP 的选择**

|         **场景**         | **推荐协议** |          **理由**          |
| :----------------------: | :----------: | :------------------------: |
|  网页浏览（HTTP/HTTPS）  |     TCP      |    需可靠传输文本、图片    |
|   文件传输（FTP/SFTP）   |     TCP      |       数据完整性优先       |
| 视频直播/语音通话（RTC） |     UDP      |  容忍部分丢包，低延迟优先  |
|   在线游戏（实时对战）   |     UDP      |   高频小包传输，延迟敏感   |
|         DNS 查询         |     UDP      | 单次请求响应快，重试成本低 |

> **核心结论**：
>
> - **TCP** 是可靠的“快递员”，保证数据完整送达，但速度较慢。
> - **UDP** 是高效的“信鸽”，速度快但可能丢信，适合能容忍丢失的场景。
>
> **设计启示**：
> 现代协议如 ​**​QUIC（HTTP/3）​**​ 在 UDP 基础上实现可靠传输，结合二者优势，是未来演进方向。